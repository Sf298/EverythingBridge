<!DOCTYPE html>
<html>
<title>Everything Bridge</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<body class="w3-light-grey w3-content" style="max-width:1600px">
    
    <style>
        .container { 
          height: 96vh;
          position: relative;
        }

        .center {
          margin: 0;
          position: absolute;
          top: 50%;
          left: 50%;
          -ms-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
        }
    </style>
    
    <script src="/tokenCode.js"></script>
    <script type="text/javascript"> 
        var token = getCookie("everythingbridgetoken");
        if(token != "") {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', "/loginChecker?token="+token, true);
            xhr.send();
            xhr.onreadystatechange = function (e) {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    if(xhr.responseText == "true") {
                        window.location.replace("/home.html?token="+token);
                    } else {
                        delCookie("everythingbridgetoken");
                    }
                }
            };
        }
        
        function handleLoginSubmit() {
            var uname = document.getElementsByName("uname")[0].value;
            var pword = document.getElementsByName("psw")[0].value;
            var remember = document.getElementsByName("remember")[0].checked;
            
            var xhr = new XMLHttpRequest();
            xhr.open('GET', "/loginChecker?uname="+uname+"&psw="+pword, true);
            xhr.send();
            xhr.onreadystatechange = function (e) {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    token = parseInt(xhr.responseText);
                    if(token > -1) {
                        if(remember)
                            setCookie("everythingbridgetoken", token, 5);
                        window.location.replace("/home.html?token="+token);
                    } else {
                        alert("Incorrect username or password!");
                    }
                }
            };
        }
    </script>
    
    <div class="container">
        <div class="center" style="border:1px solid gray;">
            <form onSubmit="JavaScript:handleLoginSubmit()" style="text-align:center; margin: 10px">
                <label for="uname"><b>Username</b></label>
                <input type="text" placeholder="Enter Username" name="uname" required>
                <br>
                <label for="psw"><b>Password</b></label>
                <input type="password" placeholder="Enter Password" name="psw" required>
                <br><br>
                <button type="submit">Login</button>
                <br><br>
                <label>
                  <input type="checkbox" name="remember"> Remember me
                </label>
            </form>
        </div>
    </div>

</body>